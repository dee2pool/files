## SOA

---

- 什么是服务

  在业务系统中能完成一个完整业务过程的功能就是服务

## ESB(系统服务总线)

---

ESB是SOA架构的一种实现思路。

业务系统之间可能采用不同的编程语言、编程框架、通信协议、消息格式和存储方案，如果这些系统需要进行服务集成，但是又没有一个成熟稳定、兼容易用的中间层进行协调，那么达到调用要求基本不可能。

为了能达到SOA架构思想的设计，ESB总线需要能够完成的任务包括:

1. 多调用协议支撑和转换

   ##### 无论业务系统向外部公布的服务使用哪种调用协议，都可以通过ESB技术进行兼容性转换。例如A业务系统的服务只接受Web Service SOAP形式的调用，B业务系统的服务却可以使用Thrift RPC进行调用（不必为了调用A业务系统而专门去适应A业务系统的协议）。在基于ESB服务的中间层帮助实现两种协议的转换。

2. 多消息格式支撑和转换

   无论调用协议携带哪一种消息描述格式，通过ESB中间层也可以实现相互转换。ESB中间层应该支持将JSON格式的信息描述转换成目标业务系统能够识别的XML格式，或者将XML描述格式转换成纯文本格式，又或者实现两种不同结构的XML格式的互相转换，等等……

3. 服务监控管理(注册、安全、版本、优先级)

   ##### 既然ESB要对原子服务进行集成，考虑的问题就比较多了。首先，业务系统提供的服务可能会以一定周期发生变化，例如周期性的升级；失控的业务系统甚至可能呈现完全无预兆无规律的服务变化，例如突发性数据割接导致服务接口变动。那么ESB的实现软件中应该有一套功能，能够保证在这样的情况下集成服务依然能够工作。其次，并不是业务系统所提供的所有服务都可以在ESB中进行集成，也并不是所有的服务都能被任何路由规则所编排。ESB应该有一套完整的功能来保证服务集成的安全性和权限。

4. 服务集成和编排

   为了将多个服务通过ESB技术进行集成形成一个新的服务，ESB技术必须能够进行服务编排。服务编排的作用就是明确原子服务执行的先后顺序、判断原子服务执行的条件、确保集成后的新服务能够按照业务设计者的要求正常工作

## ESB是EAI的进化

---

1. 在消息转换上的进化

成熟的ESB产品，一般采用开放性的传输协议和消息格式，例如使用HTTP传输协议携带查询请求、使用FTP传输协议携带上传的文件信息；采用XMPP消息格式描述IM即时通讯内容，采用MQTT消息格式描述物联网设备采集内容、使用AMQP消息格式描述MQ的内容。

2. 在流程编排上的进化

   EAI没有流程编排

3. 在服务管理上的进化

## ESB与循环依赖

---

ESB保证了各个业务服务的低耦合性，间接避免了各业务系统在集成时技术团队有意无意制造的服务循环依赖问题。（避免循环依赖的方式参照六大设计原则之一的依赖倒置原则，有一款软件SonarQube可以检查代码层面和系统模块层面的依赖关系是否良好。）





